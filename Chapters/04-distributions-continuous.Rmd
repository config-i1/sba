# Continuous distributions {#distributions}
After discussing the discrete probability distributions, we can now move to the continuous ones. The idea behind them is similar to the one discussed in Chapter \@ref(countDistributions). In this chapter, we will discuss the main properties of continuous distributions, focusing on several of them, including: Uniform, Normal, Exponential, Laplace, S, Generalised Normal, Asymmetric Laplace, Log Normal, Inverse Gaussian and Gamma.


## What is continuous distribution?
The main difference arises from the idea discussed in Section \@ref(whatIsRandomVariable): the probability that a continuous random variable will take a specific value is zero. Because of that we should be discussing the probability of a random variable taking a value in an interval. Figure \@ref(fig:distributionContinuousExample) demonstrates an empirical distribution of continuous random variable.

```{r distributionContinuousExample, echo=FALSE, fig.cap="Distribution of a continuous random variable."}
set.seed(41)
yHist <- hist(rnorm(100,100,10), probability=TRUE, main="",
              xlab="Value of variable", ylab="Probability of outcome",
              axes=FALSE, col="grey95")
axis(side=2)
axis(side=1, at=yHist$breaks)
```

Based on Figure \@ref(fig:distributionContinuousExample), we can say that the probability of obtaining the value between 100 and 105 is higher than for the variable to get any other interval. It also looks like the variable is continuous on the interval between 75 and 125, and we do not observe any values outside of this interval.

Almost any continuous distribution can be characterised by several functions:

1. Probability density function (PDF);
2. Cumulative distribution function (CDF);
3. Quantile function (QF);
4. Moment Generation Function (MMF);
5. Characteristic function.

PDF has similarities with PMF, but does not return the probabilities, but rather the score for the variable in each specific point because (once again) the probability of continuous variable taking a specific value is equal to zero. PDF however is useful because it represents the shape of the distribution, showing where the values are concentrated. Figure \@ref(fig:dnormPlotIntro) demonstrates an example of PDF of Normal distribution (discussed in more detail in Section \@ref(distributionsNormal)).

```{r dnormPlotIntro, fig.cap="Probability Density Function of Normal distribution", echo=FALSE}
plot(seq(-3,3,0.1),dnorm(seq(-3,3,0.1)),type="l",ylab="Density",xlab="y",main="")
polygon(c(seq(-5,5,0.1),rev(seq(-5,5,0.1))),
        c(dnorm(seq(-5,5,0.1)), rep(0,length(seq(-5,5,0.1)))), col="grey95")
```

It can be seen from the Figure \@ref(fig:dnormPlotIntro) that the density of the distribution is higher at its centre, around zero, which means that it is more likely to get values around the centre rather than near the tails of the distribution.

If we want to work with probabilities in case of the continuous distribution, we need to use CDF, which is similar to the one discussed in the Chapter \@ref(countDistributions). Figure \@ref(fig:dnormPlotIntroCDF) shows example of CDF of Normal distribution.

```{r dnormPlotIntroCDF, fig.cap="Cumulative Distribution Function of Normal distribution", echo=FALSE}
plot(seq(-3,3,0.1),pnorm(seq(-3,3,0.1)),type="l",ylab="Probability",xlab="y",main="")
```

The CDF of continuous variable has the same properties as CDF of the discrete one with the minor differences: in a general case it converges to one with the increase of the value $y$ and converges to zero with the decrease of it. There are some continuous distributions that are restricted with an interval. For those distributions, the CDF reaches boundary values.

CDF is obtained by calculating the surface of PDF for each specific value of $y$. Figure \@ref(fig:dnormPlotIntroCDFPDF) shows the connection between them.

```{r dnormPlotIntroCDFPDF, fig.cap="Cumulative Distribution Function of Normal distribution", echo=FALSE}
par(mfcol=c(2,1), mar=c(2,4,1,1))
plot(seq(-3,3,0.1),dnorm(seq(-3,3,0.1)),type="l",ylab="Density",xlab="y",main="")
polygon(c(seq(-5,5,0.1),rev(seq(-5,5,0.1))),
        c(dnorm(seq(-5,5,0.1)), rep(0,length(seq(-5,5,0.1)))), col="grey95")
polygon(c(seq(-3,-1,0.01),rev(seq(-3,-1,0.01))),
        c(dnorm(seq(-3,-1,0.01)), rep(0,length(seq(-3,-1,0.01)))), col="grey")
lines(c(-1,-1),c(0,dnorm(-1)),col="darkred",lwd=2,lty=1)

plot(seq(-3,3,0.1),pnorm(seq(-3,3,0.1)),type="l",ylab="Probability",xlab="y",main="")
lines(c(-1,-1),c(0,pnorm(-1)),col="darkred",lwd=2,lty=2)
lines(c(-4,-1),c(pnorm(-1),pnorm(-1)),col="darkred",lwd=2,lty=2)
```

The dark area in the first plot in Figure \@ref(fig:dnormPlotIntroCDFPDF) is equal to the probability (the value on y-axis) in the second plot, which is approximately equal to `r round(pnorm(-1),2)`.

Another important function is the Quantile Function. It returns the value of $y$ for the given probability. By the definition, QF is the inverse of the CDF. It does not always have a closed form (thus cannot be represented mathematically), and for some distributions numerical optimisation is required to obtain the quantiles. Figure \@ref(fig:dnormPlotIntroQF) demonstrates the quantile function of Normal distribution.

```{r dnormPlotIntroQF, fig.cap="Quantile Function of Normal distribution", echo=FALSE}
plot(seq(0,1,0.01),qnorm(seq(0,1,0.01)),type="l",ylab="y",xlab="Probability",main="")
lines(c(0.25,0.25),c(-3,qnorm(0.25)),col="darkred",lwd=2,lty=2)
lines(c(-1,0.25),c(qnorm(0.25),qnorm(0.25)),col="darkred",lwd=2,lty=2)
```

The dashed lines in Figure \@ref(fig:dnormPlotIntroQF) show the value of $y$ for the probability 0.25 according to the quantile function. In this example $y \approx -0.68$, meaning that in 25% of the cases the random variable $y$ will lie below this value. The quantiles of distributions are discussed in more detail in Section \@ref(dataAnalysisNumerical).

Finally, we have already mentioned MGF and CF in the context of discrete distributions. They play similar roles to the ones already discussed and can be used to obtain mean, variance, skewness and other statistics.


## Continuous Uniform distribution {#distributionsUniformContinuous}
One of the simplest continuous distributions used in statistics is the uniform one. It has similarities with the discrete one, which was discussed in Section \@ref(distributionUniform), but due to the different nature of the random variable is parameterised differently. First, because we are discussing continuous variable, it is always defined on a segment of values, from $a$ to $b$. For example, we can have a random variable which can take any value from 0 to 10 with equal likelihood. Mathematically, the PDF of continuous distribution can be written as:
\begin{equation}
    f(y, b, a) = \left\{\begin{aligned}
                        & \frac{1}{b-a} & \text{ for } y \in [a, b] \\
                        & 0 & \text{ otherwise }
                    \end{aligned} \right. .
    (\#eq:ContinuousUniformPDF)
\end{equation}
It can be represented visually as shown in Figure \@ref(fig:uniformPDF).

```{r uniformPDF, fig.cap="Probability Density Function of Continuous Uniform distribution.", echo=FALSE}
plot(seq(0,10,0.1),dunif(seq(0,10,0.1),0,10),
     ylab="Density",xlab="y", type="l", ylim=c(0,0.14))
polygon(c(seq(0,10,0.1),rev(seq(0,10,0.1))),
        c(dunif(seq(0,10,0.1),0,10), rep(0,length(seq(0,10,0.1)))), col="grey95")
lines(c(0,0), c(0,0.1), lwd=2, col="darkred")
lines(c(10,10), c(0,0.1), lwd=2, col="darkred")
```

According to this distribution, it is equally likely to have 1, 1.1, 1.0001, 9 etc values. The mean of this distribution coincides with the middle of the segment and can be calculated as:
\begin{equation}
    \mathrm{E}(y) = \frac{1}{2}(a+b) ,
    (\#eq:ContinuousUniformPDFMean)
\end{equation}
while the variance is calculated as:
\begin{equation}
    \mathrm{V}(y) = \frac{1}{12}(b-a)^2 .
    (\#eq:ContinuousUniformPDFVariance)
\end{equation}
The CDF of the Uniform distribution corresponds to the straight line going from the point (a,0) to the point (b,1), as shown in Figure \@ref(fig:uniformCDFContinuous).

```{r uniformCDFContinuous, fig.cap="Cumulative Density Function of Continuous Uniform distribution.", echo=FALSE}
plot(seq(0,10,by=0.1),punif(seq(0,10,by=0.1),0,10),
     ylab="Density",xlab="y", type="l")
```

Mathematically, the CDF can be represented as:
\begin{equation}
    F(y, b, a) = \left\{\begin{aligned}
                        & 0 & \text{ if } y<a \\
                        & \frac{y-a}{b-a} & \text{ for } y \in [a, b] \\
                        & 1 & \text{ if } y>b
                    \end{aligned} \right. .
    (\#eq:ContinuousUniformCDF)
\end{equation}

Continuous uniform distribution is sometimes used in statistics as a prior, when a researcher does not have grounds to assume any other, more complicated distribution.

In R, this distribution is implemented in `stats` package with functions `dunif()`, `punif()`, `qunif()` and `runif()` for PDF, CDF, QF and random generator respectively.


## Normal distribution {#distributionsNormal}
Every statistical textbook has Normal distribution. It is that one famous bell-curved distribution that every statistician likes because it is easy to work with and because it is an asymptotic distribution for many other well-behaved distributions under some conditions (see discussion of "Central Limit Theorem" in Section \@ref(CLT)). For example, consider the the coin tossing example and Binomial distribution discussed in Section \@ref(distributionBinomial). If we toss the coin one time only, we get the Bernoulli distribution with two outcomes. If we do that ten times, the shape of distribution will change and there will be a score with higher probability than the others (that is $\mathcal{Bi}(10, 0.5)$). If we continue tossing the coin and do that for a hundred times, the shape of distribution will start converging to the bell-curve, reminding the Normal distribution. These three cases are shown in Figure \@ref(fig:binomialPMFSeveral).

```{r binomialPMFSeveral, fig.cap="Probability Mass Functions for Binomial distribution with p=0.5 and n={1, 10, 100}.", echo=FALSE}
par(mfcol=c(1,3))
# n=1
test <- barplot(dbinom(c(0:1), size=1, prob=0.5),
                ylab="Probability",xlab="y",
                main="", col="grey95")
axis(side=1,at=test,labels=c(0:1))
# n=10
test <- barplot(dbinom(c(0:10), size=10, prob=0.5),
                ylab="Probability",xlab="y", ylim=c(0,0.25),
                main="", col="grey95")
axis(side=1,at=test,labels=c(0:10))
# n=100
test <- barplot(dbinom(c(30:70), size=100, prob=0.5),
                ylab="Probability",xlab="y", ylim=c(0,0.08),
                main="", col="grey95")
axis(side=1,at=test,labels=c(30:70))
```

This is one of the classical examples of a distribution converging to the Normal one with the increase of the number of trials $n$ under some circumstances. This also tells us that in some circumstances we can use Normal distribution as an approximation of the real distribution: in Figure \@ref(fig:binomialPMFSeveral), the third graph corresponds to the $\mathcal{Bi}(100, 0.5)$, but it can be approximated by the normal distribution $\mathcal{N}(\mu_y, \sigma)$, where $\mu_y=100 \times 0.5 = 50$ is the mean of the distribution and $\sigma^2 = 100 \times 0.5 \times 0.5 = 25$ is the variance (as discussed in Section \@ref(distributionBinomial)), i.e. $\mathcal{N}(50, 5)$.

The probability density function (PDF) of the Normal distribution with some mean $\mu_y$ and standard deviation $\sigma$ is:
\begin{equation}
    f(y, \mu_y, \sigma) = \frac{1}{\sigma\sqrt{2 \pi}} \exp \left( -\frac{1}{2} \left(\frac{y - \mu_y}{\sigma}\right)^2 \right) ,
    (\#eq:Normal)
\end{equation}

This distribution can be represented in Figure \@ref(fig:dnormPlot).

```{r dnormPlot, fig.cap="Probability Density Function of Standard Normal distribution", echo=FALSE}
plot(seq(-3,3,0.1),dnorm(seq(-3,3,0.1)),type="l",ylab="Density",xlab="y",main="")
polygon(c(seq(-5,5,0.1),rev(seq(-5,5,0.1))),
        c(dnorm(seq(-5,5,0.1)), rep(0,length(seq(-5,5,0.1)))), col="grey95")
abline(v=0, col="darkred", lwd=2)
text(0.3,0,TeX("$\\mu =0$"), pos=3)
```

Figure \@ref(fig:dnormPlot) demonstrates a standard normal distribution, meaning that $\mu_y=0$ and $\sigma=1$. A more general distribution with non-zero $\mu_y$ and a non-unity $\sigma$ will have the same shape, but will have different values on the axes. The shape itself demonstrates that there is a central tendency (in our case - the mean $\mu_y$), around which the density of values is the highest and there are other potential cases, further away from the centre of distribution, but their probability of appearance reduces proportionally to the distance from the centre. As we can see from Figure \@ref(fig:dnormPlot), the Normal distribution is symmetric. It has skewness of zero and kurtosis of 3 (see discussion in Section \@ref(dataAnalysisNumerical)).

<!-- Normal distribution is the most popular assumption for the random variable in conventional statistical models. This is represented as $y \sim \mathcal{N}(\mu_y, \sigma)$. -->

When it comes to the cumulative distribution function, it has a form of an S-curve as shown in Figure \@ref(fig:pnormPlot).

```{r pnormPlot, fig.cap="Cumulative Distribution Function of Standard Normal distribution", echo=FALSE}
plot(seq(-3,3,0.1),pnorm(seq(-3,3,0.1)),type="l",ylab="Density",xlab="y",main="")
# abline(v=0, col="red")
# text(0.5,0.05,TeX("$\\mu =0$"))
```

The CDF in Figure \@ref(fig:pnormPlot) has the properties of any other CDF: it converges to one with the increase of the value of $y$ and reaches zero asymptotically with the decrease of the value of $y$. It can be used to solve problems of the style "what is the probability that $y$ will lie between 20 and 30 for the $\mathcal{N}(20, 10)$". In R, this can be done by entering the values of $y$, $\mu$ and $\sigma$ in the following function:
```{r}
pnorm(30, 20, 10) - pnorm(20, 20, 10)
```
which mathematically is typically represented as:
\begin{equation}
    \Phi(y_2, \mu_y, \sigma) - \Phi(y_1, \mu_y, \sigma) = \Phi(30, 20, 10) - \Phi(20, 20, 10) = 0.841 - 0.5 \approx 0.341.
    (\#eq:NormalCDFExample)
\end{equation}
The CDF itself is difficult to summarise and involves a complicated integral:
\begin{equation}
    \Phi(y, \mu_y, \sigma) = \frac{1}{2} \left(1 + \mathrm{erf}\left(\frac{y-\mu_y}{\sqrt{2}\sigma} \right) \right),
    (\#eq:NormalCDFE)
\end{equation}
where $\mathrm{erf(y)= \frac{2}{\sqrt{\pi}} \int_{0}^{y} e^{-x^2} dx}$ is the so called ``error function''. This function does not have a closed form and is typically evaluated numerically or using some approximations. The probability \@ref(eq:NormalCDFExample) corresponds to the difference between the points shown in Figure \@ref(fig:pnormExample).

```{r pnormExample, fig.cap="Values of CDF for the example with Normal distribution", echo=FALSE}
plot(seq(-10,50,0.1),pnorm(seq(-10,50,0.1),20,10),type="l",ylab="Density",xlab="y",main="")
lines(c(20,20),c(0,pnorm(20,20,10)), lty=2)
lines(c(-20,20),rep(pnorm(20,20,10),2), lty=2)
text(-9,pnorm(20,20,10), pnorm(20,20,10), pos=3)
lines(c(30,30),c(0,pnorm(30,20,10)), lty=2)
lines(c(-20,30),rep(pnorm(30,20,10),2), lty=2)
text(-9,pnorm(30,20,10), round(pnorm(30,20,10),3), pos=3)
```

The same number also corresponds to the dark area in PDF of the distribution as shown in Figure \@ref(fig:dnormExample).

```{r dnormExample, fig.cap="Values of PDF for the example with Normal distribution", echo=FALSE}
plot(seq(-15,55,0.1),dnorm(seq(-15,55,0.1),20,10),type="l",ylab="Density",xlab="y",main="",
     ylim=c(0,0.04), xlim=c(-10,50))
polygon(c(seq(-15,55,0.1),rev(seq(-15,55,0.1))),
        c(dnorm(seq(-15,55,0.1),20,10), rep(0,length(seq(-15,55,0.1)))), col="grey95")
polygon(c(seq(20,30,0.1),rev(seq(20,30,0.1))),
        c(dnorm(seq(20,30,0.1),20,10), rep(0,length(seq(20,30,0.1)))), col="lightgrey")
lines(c(20,20),c(0,dnorm(20,20,10)), lwd=2, col="darkred")
lines(c(30,30),c(0,dnorm(30,20,10)), lwd=2, col="darkred")
text(25,dnorm(25,20,10)/2, round(pnorm(30,20,10)-pnorm(20,20,10),3))
```

The relation between the area in Figure \@ref(fig:dnormExample) and the difference between the two points in Figure \@ref(fig:pnormExample) comes directly from the definition of CDF, the latter being the function of cumulative values of the density function.

Many distributions converge to the Normal one or can be approximated by it under some circumstances. For example, as shown earlier, Binomial distribution can be approximated by the normal in some cases. More specifically, the approximation works when $n>20$, $n p \geq 5$ and $n(1-p) \geq 5$. Figure \@ref(fig:binomialNormalApprox) demonstrates how the normal curve (the solid red line) approximates the barplots of the Binomial distribution. 

```{r binomialNormalApprox, fig.cap="Binomial distribution and its approximation via the Normal one.", echo=FALSE}
test <- hist(rbinom(100,100,0.5), breaks=c(0:100), plot=F)
test$density <- dbinom(c(0:100), 100, 0.5)
test$breaks <- test$breaks-0.5
plot(test, xlim=c(30,70), main="", freq=FALSE, ylab="Probability", xlab="y", col="grey95")
lines(seq(30,70,0.1),dnorm(seq(30,70,0.1),50,5), col="darkgreen", lwd=2)
```

As we can see from Figure \@ref(fig:binomialNormalApprox), the normal curve fits the bars of the Binomial distribution very well, which means that we can use it, for example, to compute the probability that the variable $y$ will be equal to 41, via the formula:
\begin{equation}
    \mathrm{P}(y=41) \approx \Phi(41.5, 50, 5) - \Phi(40.5, 50, 5)
    (\#eq:BinomialNormalApproximation)
\end{equation}
In the equation \@ref(eq:BinomialNormalApproximation) by adding and subtraction 0.5, we calculate the surface of the area under the normal curve, corresponding roughly to the area of the respective bin in the barplot. We can see that this method of calculation gives a result very close to the one from the Binomial distribution:

```{r}
c(dbinom(41,100,0.5),
  pnorm(41.5,50,5)-pnorm(40.5,50,5)) |>
    setNames(c("Binomial", "Normal"))
```

This calculation based on the approximation is shown visually in Figure \@ref(fig:binomialNormalApprox), where the second figure is the zoomed-in area in the first one. As we can see, the area under the curve of the Normal distribution is roughly equal to the area of the bar of the Binomial distribution.

```{r binomialNormalApproxArea, fig.cap="Calculating the probability based on Normal approximation.", echo=FALSE}
test <- hist(rbinom(100,100,0.5), breaks=c(0:100), plot=F)
test$breaks <- test$breaks-0.5
test$density <- dbinom(c(0:100), 100, 0.5)
par(mfcol=c(1,2))
# First plot
plot(test, xlim=c(30,70),
     main="", freq=FALSE, ylab="Probability", xlab="y", col="grey95")
polygon(c(seq(40.5,41.5,0.1),rev(seq(40.5,41.5,0.1))),
        c(dnorm(seq(40.5,41.5,0.1),50,5), rep(0,length(seq(40.5,41.5,0.1)))), col=rgb(0.8,1,0.8,0.7))
lines(seq(30,70,0.1),dnorm(seq(30,70,0.1),50,5), col="darkgreen", lwd=2)
lines(c(40.5,40.5),c(0,dnorm(40.5,50,5)), lwd=2, col="darkred")
lines(c(41.5,41.5),c(0,dnorm(41.5,50,5)), lwd=2, col="darkred")
#Second plot
plot(test, xlim=c(38,44), ylim=c(0,0.05),
     main="", freq=FALSE, ylab="Probability", xlab="y", col="grey95")
polygon(c(seq(40.5,41.5,0.1),rev(seq(40.5,41.5,0.1))),
        c(dnorm(seq(40.5,41.5,0.1),50,5), rep(0,length(seq(40.5,41.5,0.1)))), col=rgb(0.8,1,0.8,0.7))
lines(seq(30,70,0.1),dnorm(seq(30,70,0.1),50,5), col="darkgreen", lwd=2)
lines(c(40.5,40.5),c(0,dnorm(40.5,50,5)), lwd=2, col="darkred")
lines(c(41.5,41.5),c(0,dnorm(41.5,50,5)), lwd=2, col="darkred")
# lines(c(40.5,41.5)+0.5,rep(dbinom(41,100,0.5),2))
```

Normal distribution is implemented in `dnorm()`, `qnorm()`, `pnorm()` and `rnorm()` functions from `stats` package in R.



<!-- ## Laplace distribution {#distributionsLaplace} -->
<!-- A more exotic distribution is Laplace, which has some similarities with Normal, but has higher excess. It has the following PDF: -->

<!-- \begin{equation} -->
<!--     f(y_t) = \frac{1}{2 s} \exp \left( -\frac{\left| y_t - \mu_{y,t} \right|}{s} \right) , -->
<!--     (\#eq:Laplace) -->
<!-- \end{equation} -->
<!-- where $s$ is the scale parameter, which, when estimated using likelihood, is equal to the Mean Absolute Error ([MAE](#errorMeasures)): -->
<!-- \begin{equation} -->
<!--     \hat{s} = \frac{1}{T} \sum_{t=1}^T \left| y_t - \hat{\mu}_{y,t} \right| . -->
<!--     (\#eq:sLaplace) -->
<!-- \end{equation} -->

<!-- It has the shape shown on Figure \@ref(fig:dlaplacePlot). -->

<!-- ```{r dlaplacePlot, fig.cap="Probability Density Function of Laplace distribution", echo=FALSE} -->
<!-- plot(seq(-3,3,0.01),dlaplace(seq(-3,3,0.01)),type="l",ylab="Density",xlab="y",main="PDF of Laplace distribution") -->
<!-- abline(v=0, col="red") -->
<!-- ``` -->

<!-- Similar to the Normal distribution, the skewness of Laplace is equal to zero. However, it has fatter tails - its kurtosis is equal to 6 instead of 3. -->

<!-- The variance of the random variable following Laplace distribution is equal to: -->
<!-- \begin{equation} -->
<!--     \sigma^2 = 2 s^2. -->
<!--     (\#eq:varianceLaplace) -->
<!-- \end{equation} -->

<!-- The `dlaplace`, `qlaplace`, `plaplace` and `rlaplace` functions from `greybox` package implement different sides of Laplace distribution in R. -->


<!-- ## S distribution -->
<!-- This is something relatively new, but not ground braking. I have derived S distribution few years ago, but have never written a paper on that. It has the following density function (it is as a special case of [Generalised Normal distribution](distributionsGeneralisedNormal), when $\beta=0.5$): -->
<!-- \begin{equation} -->
<!--     f(y_t) = \frac{1}{4 s^2} \exp \left( -\frac{\sqrt{|y_t - \mu_{y,t}|}}{s} \right) , -->
<!--     (\#eq:S) -->
<!-- \end{equation} -->
<!-- where $s$ is the scale parameter. If estimated via maximum likelihood, the scale parameter is equal to: -->
<!-- \begin{equation} -->
<!--     \hat{s} = \frac{1}{2T} \sum_{t=1}^T \sqrt{\left| y_t - \hat{\mu}_{y,t} \right|} , -->
<!--     (\#eq:sS) -->
<!-- \end{equation} -->
<!-- which corresponds to the minimisation of a half of "Mean Root Absolute Error" or "Half Absolute Moment" (HAM). This is a more exotic type of scale, but the main benefit of this distribution is sever heavy tails - it has kurtosis of 25.2. It might be useful in cases of randomly occurring incidents and extreme values (Black Swans?). -->

<!-- ```{r dsPlot, fig.cap="Probability Density Function of S distribution", echo=FALSE} -->
<!-- plot(seq(-3,3,0.01),ds(seq(-3,3,0.01)),type="l",ylab="Density",xlab="y",main="PDF of S distribution") -->
<!-- abline(v=0, col="red") -->
<!-- ``` -->

<!-- The variance of the random variable following S distribution is equal to: -->
<!-- \begin{equation} -->
<!--     \sigma^2 = 120 s^4. -->
<!--     (\#eq:varianceS) -->
<!-- \end{equation} -->

<!-- The `ds`, `qs`, `ps` and `rs` from `greybox` package implement the density, quantile, cumulative and random generation functions. -->


<!-- ## Generalised Normal distribution {#distributionsGeneralisedNormal} -->
<!-- Generalised Normal ($\mathcal{GN}$) distribution (as the name says) is a generalisation for Normal distribution, which also includes Laplace and S as special cases [@Nadarajah2005]. There are two versions of this distribution: one with a shape and another with a skewness parameter. We are mainly interested in the first one, which has the following PDF: -->
<!-- \begin{equation} -->
<!--     f(y_t) = \frac{\beta}{2 s \Gamma(\beta^{-1})} \exp \left( -\left(\frac{|y_t - \mu_{y,t}|}{s}\right)^{\beta} \right), -->
<!--     (\#eq:GND) -->
<!-- \end{equation} -->
<!-- where $\beta$ is the shape parameter, and $s$ is the scale of the distribution, which, when estimated via MLE, is equal to: -->
<!-- \begin{equation} -->
<!--     \hat{s} = \sqrt[^{\beta}]{\frac{\beta}{T} \sum_{t=1}^T\left| y_t - \hat{\mu}_{y,t} \right|^{\beta}}, -->
<!--     (\#eq:sGND) -->
<!-- \end{equation} -->
<!-- which has MSE, MAE and HAM as special cases, when $\beta$ is equal to 2, 1 and 0.5 respectively. The parameter $\beta$ influences the kurtosis directly, it can be calculated for each special case as $\frac{\Gamma(5/\beta)\Gamma(1/\beta)}{\Gamma(3/\beta)^2}$. The higher $\beta$ is, the lower the kurtosis is. -->

<!-- The advantage of $\mathcal{GN}$ distribution is its flexibility. In theory, it is possible to model extremely rare events with this distribution, if the shape parameter $\beta$ is fractional and close to zero. Alternatively, when $\beta \rightarrow \infty$, the distribution converges point-wise to the uniform distribution on $(\mu_{y,t} - s, \mu_{y,t} + s)$. -->

<!-- Note that the estimation of $\beta$ is a difficult task, especially, when it is less than 2 - the MLE of it looses properties of consistency and asymptotic normality. -->

<!-- Depending on the value of $\beta$, the distribution can have different shapes shown in Figure \@ref(fig:dgnormPlot) -->

<!-- ```{r dgnormPlot, fig.cap="Probability Density Functions of Generalised Normal distribution", echo=FALSE} -->
<!-- plot(seq(-3,3,0.01),dgnorm(seq(-3,3,0.01),0,1,0.5),type="l",ylab="Density",xlab="y",main="PDF of Generalised Normal distribution", -->
<!--      ylim=c(0,0.6)) -->
<!-- lines(seq(-3,3,0.01),dgnorm(seq(-3,3,0.01),0,1,1),col="darkblue") -->
<!-- lines(seq(-3,3,0.01),dgnorm(seq(-3,3,0.01),0,1,2),col="darkred") -->
<!-- lines(seq(-3,3,0.01),dgnorm(seq(-3,3,0.01),0,1,1000),col="purple") -->
<!-- abline(v=0, col="red") -->
<!-- legend("topright",legend=c(TeX("$\\beta =0.5$"),TeX("$\\beta =1$"),TeX("$\\beta =2$"),TeX("$\\beta =1000$")), -->
<!--        col=c("black","darkblue","darkred","purple"),lwd=1) -->
<!-- ``` -->

<!-- Typically, estimating $\beta$ consistently is a tricky thing to do, especially if it is less than one. Still, it is possible to do that by maximising the likelihood function \@ref(eq:GND). -->

<!-- The variance of the random variable following Generalised Normal distribution is equal to: -->
<!-- \begin{equation} -->
<!--     \sigma^2 = s^2\frac{\Gamma(3/\beta)}{\Gamma(1/\beta)}. -->
<!--     (\#eq:varianceGN) -->
<!-- \end{equation} -->

<!-- The working functions for the Generalised Normal distribution are implemented in the `greybox` package for R. -->


<!-- ## Asymmetric Laplace distribution {#distributionsALaplace} -->

<!-- Asymmetric Laplace distribution ($\mathcal{AL}$) can be considered as a two Laplace distributions with different parameters $s$ for left and right sides from the location $\mu_{y,t}$. There are several ways to summarise the probability density function, the neater one relies on the asymmetry parameter $\alpha$ [@Yu2005]: -->
<!-- \begin{equation} -->
<!--     f(y_t) = \frac{\alpha (1- \alpha)}{s} \exp \left( -\frac{y_t - \mu_{y,t}}{s} (\alpha - I(y_t \leq \mu_{y,t})) \right) , -->
<!--     (\#eq:ALaplace) -->
<!-- \end{equation} -->
<!-- where $s$ is the scale parameter, $\alpha$ is the skewness parameter and $I(y_t \leq \mu_{y,t})$ is the indicator function, which is equal to one, when the condition is satisfied and to zero otherwise. The scale parameter $s$ estimated using likelihood is equal to the quantile loss: -->
<!-- \begin{equation} -->
<!--     \hat{s} = \frac{1}{T} \sum_{t=1}^T \left(y_t - \hat{\mu}_{y,t} \right)(\alpha - I(y_t \leq \hat{\mu}_{y,t})) . -->
<!--     (\#eq:sALaplace) -->
<!-- \end{equation} -->
<!-- Thus maximising the likelihood \@ref(eq:ALaplace) is equivalent to estimating the model via the minimisation of $\alpha$ quantile, making this equivalent to quantile regression approach. So quantile regression models assume indirectly that the error term in the model is $\epsilon_t \sim \mathcal{AL}(0, s, \alpha)$ [@Geraci2007]. -->

<!-- Depending on the value of $\alpha$, the distribution can have different shapes, shown in Figure \@ref(fig:dALaplacePlot). -->

<!-- ```{r dALaplacePlot, fig.cap="Probability Density Functions of Asymmetric Laplace distribution", echo=FALSE} -->
<!-- plot(seq(-3,3,0.01),dalaplace(seq(-3,3,0.01),0,1,0.5),type="l",ylab="Density",xlab="y",main="PDF of Asymmetric Laplace distribution", -->
<!--      ylim=c(0,0.6)) -->
<!-- lines(seq(-3,3,0.01),dalaplace(seq(-3,3,0.01),0,1,0.2),col="darkblue") -->
<!-- lines(seq(-3,3,0.01),dalaplace(seq(-3,3,0.01),0,1,0.8),col="darkred") -->
<!-- abline(v=0, col="red") -->
<!-- legend("topright",legend=c(TeX("$\\alpha =0.5$"),TeX("$\\alpha =0.2$"),TeX("$\\alpha =0.8$")), -->
<!--        col=c("black","darkblue","darkred"),lwd=1) -->
<!-- ``` -->

<!-- Similarly to $\mathcal{GN}$ distribution, the parameter $\alpha$ can be estimated during the maximisation of the likelihood, although it makes more sense to set it to some specific values in order to obtain the desired quantile of distribution. -->

<!-- The variance of the random variable following Asymmetric Laplace distribution is equal to: -->
<!-- \begin{equation} -->
<!--     \sigma^2 = s^2\frac{(1-\alpha)^2+\alpha^2}{\alpha^2(1-\alpha)^2}. -->
<!--     (\#eq:varianceALaplace) -->
<!-- \end{equation} -->

<!-- Functions `dalaplace`, `qalaplace`, `palaplace` and `ralaplace` from `greybox` package implement the Asymmetric Laplace distribution. -->


<!-- ## Log Normal, Log Laplace, Log S and Log GN distributions -->

<!-- In addition, it is possible to derive the log-versions of the Normal, $\mathcal{Laplace}$, $\mathcal{S}$, and $\mathcal{GN}$ distributions. The main differences between the original and the log-versions of density functions for these distributions can be summarised as follows: -->
<!-- \begin{equation} -->
<!--     f_{log}(\log(y_t)) = \frac{1}{y_t} f(\log y_t). -->
<!--     (\#eq:logDistribution) -->
<!-- \end{equation} -->
<!-- They are defined for positive values only and will have different right tail, depending on the location, scale and shape parameters. $\exp(\mu_{\log y,t})$ in this case represents the geometric mean (and median) of distribution rather than the arithmetic one. The conditional expectation in these distributions is typically higher than $\exp(\mu_{\log y,t})$ and depends on the value of the scale parameter. It is known for log$\mathcal{N}$ and is equal to: -->
<!-- \begin{equation} -->
<!--     \mathrm{E}(y_t) = \mathrm{exp}\left(\mu_{\log y,t} + \frac{\sigma^2}{2} \right). -->
<!--     (\#eq:logNMean) -->
<!-- \end{equation} -->
<!-- However, it does not have a simple form for the other distributions. -->


<!-- ## Inverse Gaussian distribution {#IGDistribution} -->

<!-- An exotic distribution that will be useful for what comes in this textbook is the Inverse Gaussian ($\mathcal{IG}$), which is parameterised using mean value $\mu_{y,t}$ and either the dispersion parameter $s$ or the scale $\lambda$ and is defined for positive values only. This distribution is useful because it is scalable and has some similarities with the Normal one. In our case, the important property is the following: -->
<!-- \begin{equation} -->
<!--     \text{if } (1+\epsilon_t) \sim \mathcal{IG}(1, s) \text{, then } -->
<!--     y_t = \mu_{y,t} \times (1+\epsilon_t) \sim \mathcal{IG}\left(\mu_{y,t}, \frac{s}{\mu_{y,t}} \right), -->
<!--     (\#eq:InverseGaussianModel) -->
<!-- \end{equation} -->
<!-- implying that the dispersion of the model changes together with the expectation. The PDF of the distribution of $1+\epsilon_t$ is: -->

<!-- \begin{equation} -->
<!--     f(1+\epsilon_t) = \frac{1}{\sqrt{2 \pi s (1+\epsilon_t)^3}} \exp \left( -\frac{\epsilon_t^2}{2 s (1+\epsilon_t)} \right) , -->
<!--     (\#eq:InverseGaussian) -->
<!-- \end{equation} -->
<!-- where the dispersion parameter can be estimated via maximising the likelihood and is calculated using: -->
<!-- \begin{equation} -->
<!--     \hat{s} = \frac{1}{T} \sum_{t=1}^T \frac{e_t^2}{1+e_t} , -->
<!--     (\#eq:InverseGaussianDispersion) -->
<!-- \end{equation} -->
<!-- where $e_t$ is the estimate of $\epsilon_t$. This distribution becomes very useful for multiplicative models, where it is expected that the data can only be positive. -->

<!-- Figure \@ref(fig:dIGPlot) shows how the PDF of $\mathcal{IG}(1,s)$ looks for different values of the dispersion $s$ -->

<!-- ```{r dIGPlot, fig.cap="Probability Density Functions of Inverse Gaussian distribution", echo=FALSE} -->
<!-- plot(seq(0,6,0.01),dinvgauss(seq(0,6,0.01),1,dispersion=10),type="l",ylab="Density",xlab="y",main="PDF of Inverse Gaussian distribution") -->
<!-- lines(seq(0,6,0.01),dinvgauss(seq(0,6,0.01),1,dispersion=1),col="darkblue") -->
<!-- lines(seq(0,6,0.01),dinvgauss(seq(0,6,0.01),1,dispersion=0.1),col="darkred") -->
<!-- abline(v=1, col="red") -->
<!-- legend("topright",legend=c(TeX("$s =10$"),TeX("$s =1$"),TeX("$s =0.1$")), -->
<!--        col=c("black","darkblue","darkred"),lwd=1) -->
<!-- ``` -->

<!-- `statmod` package implements density, quantile, cumulative and random number generator functions for the $\mathcal{IG}$. -->


<!-- ## Gamma distribution {#GammaDistribution} -->
<!-- Finally, another distribution that will be useful for [ETS](#ADAMETSIntroduction) and [ARIMA](#ADAMARIMA) is Gamma ($\mathcal{\Gamma}$), which is parameterised using shape $\xi$ and scale $s$, and is defined for positive values only. This distribution is useful because it is scalable and is as flexible as ($\mathcal{IG}$) in terms of possible shapes. It also has an important scalability property (simila to $\mathcal{IG}$), but the shape needs to be restricted in order to make sense in ETS model: -->
<!-- \begin{equation} -->
<!--     \text{if } (1+\epsilon_t) \sim \mathcal{\Gamma}(s^{-1}, s) \text{, then } -->
<!--     y_t = \mu_{y,t} \times (1+\epsilon_t) \sim \mathcal{\Gamma}\left(s^{-1}, s \mu_{y,t} \right), -->
<!--     (\#eq:GammaModel) -->
<!-- \end{equation} -->
<!-- implying that the scale of the model changes together with the expectation. The restriction on the shape parameters is needed in order to make the expectation of $(1+\epsilon_t)$ equal to one. The PDF of the distribution of $1+\epsilon_t$ is: -->

<!-- \begin{equation} -->
<!--     f(1+\epsilon_t) = \frac{1}{\Gamma(s^{-1}) (s)^{s^{-1}}} (1+\epsilon_t)^{s^{-1}-1}\exp \left(-\frac{1+\epsilon_t}{s}\right) . -->
<!--     (\#eq:Gamma) -->
<!-- \end{equation} -->
<!-- However, the scale $s$ cannot be estimated via the maximisation of likelihood analytically due to the restriction \@ref(eq:GammaModel). Luckliy, the method of moments can be used instead, where based on the expectation and variance we get: -->
<!-- \begin{equation} -->
<!--     \hat{s} = \frac{1}{T} \sum_{t=1}^T e_t^2 , -->
<!--     (\#eq:GammaScale) -->
<!-- \end{equation} -->
<!-- where $e_t$ is the estimate of $\epsilon_t$. So, imposing the restrictions \@ref(eq:GammaModel) implies that the scale of $\mathcal{\Gamma}$ is equal to the variance of the error term. -->

<!-- Figure \@ref(fig:dGammaPlot) demonstrates how the PDF of $\mathcal{\Gamma}(s^{-1},s)$ looks for different values of $s$: -->

<!-- ```{r dGammaPlot, fig.cap="Probability Density Functions of Gamma distribution", echo=FALSE} -->
<!-- plot(seq(0,6,0.01),dgamma(seq(0,6,0.01),0.1,scale=10),type="l",ylab="Density",xlab="y",main="PDF of Gamma distribution") -->
<!-- lines(seq(0,6,0.01),dgamma(seq(0,6,0.01),1,scale=1),col="darkblue") -->
<!-- lines(seq(0,6,0.01),dgamma(seq(0,6,0.01),10,scale=0.1),col="darkred") -->
<!-- abline(v=1, col="red") -->
<!-- legend("topright",legend=c(TeX("$s =10$"),TeX("$s =1$"),TeX("$s =0.1$")), -->
<!--        col=c("black","darkblue","darkred"),lwd=1) -->
<!-- ``` -->

<!-- With the increase of the shape $\xi=s^{-1}$ (in our case this implies the decrease of variance $s$), $\mathcal{\Gamma}$ distribution converges to the normal one with $\mu=\xi s=1$ and variance $\sigma^2=s$. This demonstrates indirectly that the estimate of the scale \@ref(eq:GammaScale) maximises the likelihood of the function \@ref(eq:Gamma), although I do not have any proper proof of this. -->


<!-- ## Beta distribution -->
